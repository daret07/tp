{% extends 'core/crear.html'%}
{% block extra_head %}
{{block.super}}
<style type="text/css">
  .box{
    padding: 25px
  }
  .botton{
    padding: 0px;
    border-color: white;
    border-width: 0px
  }
</style>
<script type="text/javascript">
 $(document).ready(function(){
  {%if matricula %}
  $('#id_matricula').val('{{matricula}}');
  {%endif%}
  {%if not obj%}
    $('#id_emergencia option').remove() 
  {%endif%}
      /*=====================================================================================*/
$('#agregar_principal').click(function(){
  if ($('#id_fecha_de_ingreso').val() != "" &&
    $("#id_fecha_de_nacimiento").val() != "" &&
    $("#id_matricula").val() != "" &&
    $("#id_plaza option:selected").val() > 0 &&
    $("#id_equipo").val() != "" &&
    $("#id_rama option:selected").val() > 0){
    var ano_ingreso = $("#id_fecha_de_ingreso").val();
    var ingreso_uno = ano_ingreso.substr(8, 1);
    var ingreso_dos = ano_ingreso.substr(9, 1);

    var matricula = $("#id_matricula").val();
    var matricula_uno = matricula.substr(0, 1);
    var matricula_dos = matricula.substr(1, 1);
    var matricula_tres = matricula.substr(2, 1);
    var matricula_cuatro = matricula.substr(3, 1);

    var tipo_pago = 2;
    var monto_1 = 0;
    var monto_2 = 0;
    var plaza = $("#id_plaza option:selected").val();

    var ano_nacimiento = $("#id_fecha_de_nacimiento").val();

    var ano_nacimiento_uno = ano_nacimiento.substr(8, 1);
    var ano_nacimiento_dos = ano_nacimiento.substr(9, 1);

    var equipo = $("#id_equipo").val();
    var rama = $("#id_rama option:selected").val();

    var arreglo_ponderacion = [3,1];

    /* Sumar todo */

    var sumatoria = parseInt(ingreso_uno*arreglo_ponderacion[0]) + parseInt(ingreso_dos*arreglo_ponderacion[1]) + parseInt(matricula_uno*arreglo_ponderacion[0]) + parseInt(matricula_dos*arreglo_ponderacion[1]) + parseInt(matricula_tres*arreglo_ponderacion[0]) + parseInt(matricula_cuatro*arreglo_ponderacion[1]) + parseInt(tipo_pago*arreglo_ponderacion[0]) + parseInt(monto_1*arreglo_ponderacion[1]) + parseInt(monto_2*arreglo_ponderacion[0]) + parseInt(plaza*arreglo_ponderacion[1]) + parseInt(ano_nacimiento_uno*arreglo_ponderacion[0]) + parseInt(ano_nacimiento_dos*arreglo_ponderacion[1]) + parseInt(equipo*arreglo_ponderacion[0]) + parseInt(rama*arreglo_ponderacion[1]);

    var sumatoria_dos = (sumatoria < 10) ? sumatoria : sumatoria.toString().substring(2, 1);
    var digito_verificador = 10 - sumatoria_dos;

    if (digito_verificador == 10) {
      digito_verificador = 0;
    }
    var referencia = ingreso_uno + "" + ingreso_dos + "" + matricula_uno + "" + matricula_dos + "" + matricula_tres + "" + matricula_cuatro + "" + tipo_pago + "" + monto_1 + "" + monto_2 + "" + plaza + "" + ano_nacimiento_uno + "" + ano_nacimiento_dos + "" + equipo + "" + rama + "" + digito_verificador;

    addForm('','#referencias','referencias_set');
      $(".dynamic-form").last('tr').removeClass('hidden');
      $(".dynamic-form").last('tr').find('input:first').val(referencia);
      $(".dynamic-form").last('tr').find('input:first').prop("readonly", true);
      $(".dynamic-form").last('tr').find('textarea:first').val('Referencia Principal');
      $(".dynamic-form").last('tr').attr('data-tipo','principal');
      $(this).hide();
    }else{
      alert("Es necesario llenar toda la información para poder generar la referencia");
  };
});
       /*==========================================================================================================*/


$('#agregar_uniforme').on('click',function(){
              if (
      $("#id_fecha_de_ingreso").val() !== "" &&
      $("#id_fecha_de_nacimiento").val() !== "" &&
      $("#id_matricula").val() !== "" &&
      $("#id_plaza option:selected").val() > 0 &&
      $("#id_equipo").val() !== "" &&
      $("#id_rama option:selected").val() !== ""
        ){
        /* Generar Referencia Uniformes */
        var ano_ingreso = $("#id_fecha_de_ingreso").val();
        var ingreso_uno = ano_ingreso.substr(8, 1);
        var ingreso_dos = ano_ingreso.substr(9, 1);

        var matricula = $("#id_matricula").val();
        var matricula_uno = matricula.substr(0, 1);
        var matricula_dos = matricula.substr(1, 1);
        var matricula_tres = matricula.substr(2, 1);
        var matricula_cuatro = matricula.substr(3, 1);

        var tipo_pago = 5;
        var monto_1 = 0;
        var monto_2 = 0;
        var plaza = $("#id_plaza option:selected").val();

        var ano_nacimiento = $("#id_fecha_de_nacimiento").val();

        var ano_nacimiento_uno = ano_nacimiento.substr(8, 1);
        var ano_nacimiento_dos = ano_nacimiento.substr(9, 1);

        var equipo = $("#id_equipo").val();
        var rama = $("#id_rama option:selected").val();

        var arreglo_ponderacion = [3,1];

        /* Sumar todo */

        var sumatoria = parseInt(ingreso_uno*arreglo_ponderacion[0]) + parseInt(ingreso_dos*arreglo_ponderacion[1]) + parseInt(matricula_uno*arreglo_ponderacion[0]) + parseInt(matricula_dos*arreglo_ponderacion[1]) + parseInt(matricula_tres*arreglo_ponderacion[0]) + parseInt(matricula_cuatro*arreglo_ponderacion[1]) + parseInt(tipo_pago*arreglo_ponderacion[0]) + parseInt(monto_1*arreglo_ponderacion[1]) + parseInt(monto_2*arreglo_ponderacion[0]) + parseInt(plaza*arreglo_ponderacion[1]) + parseInt(ano_nacimiento_uno*arreglo_ponderacion[0]) + parseInt(ano_nacimiento_dos*arreglo_ponderacion[1]) + parseInt(equipo*arreglo_ponderacion[0]) + parseInt(rama*arreglo_ponderacion[1]);

        var sumatoria_dos = (sumatoria < 10) ? sumatoria : sumatoria.toString().substring(2, 1);
        var digito_verificador = 10 - sumatoria_dos;
        if (digito_verificador == 10) {
          digito_verificador = 0;
        }
        var referencia = ingreso_uno + "" + ingreso_dos + "" + matricula_uno + "" + matricula_dos + "" + matricula_tres + "" + matricula_cuatro + "" + tipo_pago + "" + monto_1 + "" + monto_2 + "" + plaza + "" + ano_nacimiento_uno + "" + ano_nacimiento_dos + "" + equipo + "" + rama + "" + digito_verificador;

    addForm('','#referencias','referencias_set');
            $(".dynamic-form").last('tr').removeClass('hidden');
            $(".dynamic-form").last('tr').find('input:first').val(referencia);
            $(".dynamic-form").last('tr').find('input:first').prop("readonly", true);
            $(".dynamic-form").last('tr').find('textarea:first').val('Referencia Uniformes');
            $(".dynamic-form").last('tr').attr('data-tipo','uniforme');
            $(this).hide();
  } else {
    alert("Es necesario llenar toda la informaciÃ³n para poder generar la referencia");
  }
});

    /*================================================================================*/

$('#agregar').on('click',function(){
      addForm('','#referencias','referencias_set');
      $(".dynamic-form").last('tr').removeClass('hidden');
    });

$('.tab-pane').on('click','.delete-row',function(){
    var tipo = $(this).closest('tr').data('tipo');
    if(tipo=='principal'){
        $('#agregar_principal').show();
      }
    if(tipo=='uniforme'){
      $('#agregar_uniforme').show();
    }
     deleteForm($(this),'#referencias','referencias_set');
});

$('.botton').on('click','.bto',function(){
  referente = $(this).data('val');
  var parametros = {
    'met' : referente
  }
  showModal('catalogo','persona_modal',parametros);
});
 });
</script>
{% endblock %}
{% block contenido %}
<form method="post" enctype="multipart/form-data" action="">
  {% csrf_token %}
  
  <div class="row">
    <div class="col-md-12">
      <div class="box box-danger">
        <h3 class='box-title'>Datos del Alumno</h3>
        <div class='box-body'>
          <div class="row">
            <div class="col-md-2{%if form.nombre.errors%} error {%endif%}">{{form.nombre.label_tag}}</div>
            <div class="col-md-6">{{form.nombre}}</div>
            <div class="col-md-2{%if form.fecha_de_ingreso.errors%} error {%endif%}">{{form.fecha_de_ingreso.label_tag}}</div>
            <div class="col-md-2">{{form.fecha_de_ingreso}}</div>
          </div>
          <div class="row">
            <div class="col-md-2{%if form.paterno.errors%} error {%endif%}">{{form.paterno.label_tag}}</div>
            <div class="col-md-6">{{form.paterno}}</div>
            <div class="col-md-2{%if form.ciclo_escolar.errors%} error {%endif%}">{{form.ciclo_escolar.label_tag}}</div>
            <div class="col-md-2">{{form.ciclo_escolar}}</div>
          </div>
          <div class="row">
            <div class="col-md-2{%if form.materno.errors%} error {%endif%}">{{form.materno.label_tag}}</div>
            <div class="col-md-6">{{form.materno}}</div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="box box-danger">
        <h3 class='box-title'></h3>
        <div class='box-body'>
          <div class="row">
            <div class="col-md-4{%if form.matricula.errors%} error {%endif%}">{{form.matricula.label_tag}}</div>
            <div class="col-md-8">{{form.matricula}}</div>
          </div>
          <div class="row">
            <div class="col-md-4{%if form.calle.errors%} error {%endif%}">{{form.calle.label_tag}}</div>
            <div class="col-md-8">{{form.calle}}</div>
          </div>
          <div class="row">
            <div class="col-md-4{%if form.no.errors%} error {%endif%}">{{form.no.label_tag}}</div>
            <div class="col-md-8">{{form.no}}</div>
          </div>
          <div class="row">
            <div class="col-md-4{%if form.colonia.errors%} error {%endif%}">{{form.colonia.label_tag}}</div>
            <div class="col-md-8">{{form.colonia}}</div>
          </div>
          <div class="row">
            <div class="col-md-4{%if form.cp.errors%} error {%endif%}">{{form.cp.label_tag}}</div>
            <div class="col-md-8">{{form.cp}}</div>
          </div>
          <div class="row">
            <div class="col-md-4{%if form.poblacion.errors%} error {%endif%}">{{form.poblacion.label_tag}}</div>
            <div class="col-md-8">{{form.poblacion}}</div>
          </div>
          <div class="row">
            <div class="col-md-4{%if form.municipio.errors%} error {%endif%}">{{form.municipio.label_tag}}</div>
            <div class="col-md-8">{{form.municipio}}</div>
          </div>
          <div class="row">  
            <div class="col-md-4{%if form.entidad_federativa.errors%} error {%endif%}">{{form.entidad_federativa.label_tag}}</div>
            <div class="col-md-8">{{form.entidad_federativa}}</div>
          </div>
          <div class="row">  
            <div class="col-md-4">&nbsp;</div>
            <div class="col-md-8">&nbsp;</div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="box box-danger">
        <h3 class='box-title'></h3>
        <div class='box-body'>
          <div class="row secundario">
            <div class="col-md-5 col-sm-4 col-xs-4{%if form.fecha_de_nacimiento.errors%} error {%endif%}">{{form.fecha_de_nacimiento.label_tag}}</div>
            <div class="col-md-7 col-sm-8 col-xs-8">{{form.fecha_de_nacimiento}}</div>
          </div>
          <div class="row">
            <div class="col-md-5 col-sm-4 col-xs-4{%if form.lugar_de_nacimiento.errors%} error {%endif%}">{{form.lugar_de_nacimiento.label_tag}}</div>
            <div class="col-md-7 col-sm-8 col-xs-8">{{form.lugar_de_nacimiento}}</div>
          </div>
          <div class="row">
            <div class="col-md-5 col-sm-4 col-xs-4{%if form.padre.errors%} error {%endif%}">{{form.padre.label_tag}}</div>
            <div class="col-md-7 col-sm-8 col-xs-8">
              <div class="input-group"> 
                {{form.padre}}
                <div class="input-group-addon botton"><i class=" btn btn-primary fa fa-plus bto" data-val="padre"></i></div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-5 col-sm-4 col-xs-4{%if form.emergencia.errors%} error {%endif%}">{{form.emergencia.label_tag}}</div>
            <div class="col-md-7 col-sm-8 col-xs-8">
              <div class="input-group"> 
                {{form.emergencia}}
                <div class="input-group-addon botton"><i class=" btn btn-primary fa fa-plus bto" data-val="emergencia"></i></div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-5 col-sm-4 col-xs-4{%if form.plaza.errors%} error {%endif%}">{{form.plaza.label_tag}}</div>
            <div class="col-md-7 col-sm-8 col-xs-8">{{form.plaza}}</div>
          </div>
          <div class="row">
            <div class="col-md-5 col-sm-4 col-xs-4{%if form.equipo.errors%} error {%endif%}">{{form.equipo.label_tag}}</div>
            <div class="col-md-7 col-sm-8 col-xs-8">{{form.equipo}}</div>
          </div>
          <div class="row">
            <div class="col-md-5 col-sm-4 col-xs-4{%if form.rama.errors%} error {%endif%}">{{form.rama.label_tag}}</div>
            <div class="col-md-7 col-sm-8 col-xs-8">{{form.rama}}</div>
          </div>
          <div class="row">
            <div class="col-md-5 col-sm-4 col-xs-4{%if form.estatus.errors%} error {%endif%}"><b>Activo</b></div>
            <div class="col-md-7 col-sm-2 col-xs-1">{{form.estatus}}</div>
          </div>
          <div class="row">
            <div class="col-md-5 col-sm-5 col-xs-5{%if form.hermano_institucion.errors%} error {%endif%}">{{form.hermano_institucion.label_tag}}</div>
            <div class="col-md-7 col-sm-1 col-xs-1 ">{{form.hermano_institucion}}</div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-12">
    <div class="tab-pane">
      <div class="box box-danger">
        <h3 class='box-title'>Referencias</h3>
        <div class='box-body agre'>
        <i class="btn btn-primary fa fa-plus" id='agregar'></i>
        <i class="btn btn-primary" id='agregar_principal'>Crear Referencia Principal</i>
        <i class="btn btn-danger" id='agregar_uniforme'>Crear Referencia Uniforme</i>
        <div id="referencias">
        {{form_req.management_form}}
          <table class='table table-condensed'>
            <thead>
              <tr>
                <th>Referencia</th>
                <th style="width:70%">Descripción</th>
                <th style="width:10%">Eliminar</th>
                <th hidden></th>
              </tr>
            </thead>
            <tbody>
            {%for i in form_req%}
              <tr class="dynamic-form">
                <td>{{i.referencia}}</td>
                <td>{{i.descripcion}}</td>
                <td>{{i.DELETE}}</td>
                <td hidden>{{i.id}}</td>
              </tr>
            {%endfor%}
            </tbody>
          </table>
        </div>
        </div>
    </div>
  </div>
</form>
{% endblock %}